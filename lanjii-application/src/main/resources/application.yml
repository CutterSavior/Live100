spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:prod}

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/lanjii_v3}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    type: com.alibaba.druid.pool.DruidDataSource

    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: true
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,slf4j
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
      stat-view-servlet:
        enabled: false
      web-stat-filter:
        enabled: false

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

server:
  port: ${PORT:8080}

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-not-delete-value: 0
      logic-delete-value: 1
  mapper-locations: classpath*:com/lanjii/**/dao/*.xml
  type-aliases-package: com.lanjii.**.entity

lanjii:
  cache:
    type: LOCAL
    cache-null-values: true
    default-ttl: 1h
    default-max-size: 1000

  tenant:
    enabled: true
    column: tenant_id
    ignore-tables:
      - sys_tenant
      - sys_tenant_package
      - sys_menu
      - sys_dict_type
      - sys_dict_data
      - sys_config
      - sys_notice
      - sys_notice_read_record

  security:
    jwt:
      secret: ${JWT_SECRET:replace_this_in_production}
      expiration: 86400000
    whitelist:
      - "/"
      - "/chat/**"
      - "/admin/login"
      - "/admin/captcha"
      - "/druid/**"
      - "/static/**"
      - "/health"
      - "/healthz"
      - "/status"
      - "/ws/**"
      - "/upload/**"

  ai:
    vector:
      rebuild-on-startup: false

  file:
    upload-path: ${UPLOAD_PATH:/opt/app/lanjii/upload/}
    access-prefix: /upload/
